#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.dirname(File.realpath(__FILE__)) + '/../lib')
require 'yaml'
require 'optparse'
require 'yaml_bot'

banner = <<-eos
I am feed me YAML!
eos

options = {}
parser = OptionParser.new do |opts|
  opts.banner = banner
  opts.banner += "Usage: yamlbot [options] <file(s) or folder(s)>"

  opts.on('-r', '--rule-file', 'The rules you will be evaluating your yaml against') do |r|
    options[:rules] = r
  end

  opts.on('-f', '--file', 'The file to validate against') do |f|
    options[:file] = f
  end
end
parser.parse!

begin
  file = 'test.yml'
  rules_file = '.yamlbot.yml'
  rules_file = options[:rules] unless options[:rules].nil?
  bot = YamlBot::YamlBot.new(file, rules_file)
  bot.scan
rescue Exception => e
  puts e.message
  puts e.backtrace
  # puts "Rules file not located.\n"
  # puts "Feed me yaml!"
  # puts "Enter yamlbot -h for help documentation\n"
  exit 1
end

puts 'YAMLBOT finished scanning...'
puts "#{YamlBot::YamlBot.get_violations} violations"
#exit result
