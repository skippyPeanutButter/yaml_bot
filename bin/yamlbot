#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.dirname(File.realpath(__FILE__)) + '/../lib')

require 'yaml'
require 'optparse'
require 'yaml_bot'
require 'yaml_bot/rules_bot'
#require 'benchmark'

banner = <<-eos
I am feed me YAML!
eos

options = {}
parser = OptionParser.new do |opts|
  opts.banner = banner
  opts.banner += "Usage: yamlbot [options] <file(s) or folder(s)>"

  opts.on('-r', '--rule-file', 'The rules you will be evaluating your yaml against') do |r|
    options[:rules] = r
  end

  opts.on('-f', '--file', 'The file to validate against') do |f|
    options[:file] = f
  end
end
parser.parse!

rules_file = YAML.load(File.open(options[:rules]))
yaml_file = YAML.load(File.open(options[:file]))

rules_bot = RulesBot.new
rules_bot.rules = rules_file
rules_bot.validate_rules

puts 'YAMLBOT finished scanning...'
#puts "#{YamlBot::YamlBot.get_violations} violations"
#exit result
